**Feature 1: 菜單瀏覽與購物車操作**

```gherkin
# ================================================
# Feature 1: 菜單瀏覽與購物車操作
# ================================================

Feature: 菜單瀏覽與購物車操作
  作為一個忙碌的顧客
  我希望能夠快速瀏覽當前供應的早餐菜單
  將選定的餐點加入購物車
  並清楚查看總價
  以便在短時間內完成點餐

  Rule: 確保顧客能將多種餐點加入訂單
    Background:
      Given 系統中存在以下菜單項目：
        | item_id | name       | price | stock |
        | 001     | 經典蛋餅   | 35    | 50    |
        | 002     | 冰美式咖啡 | 45    | 30    |
        | 003     | 培根蛋三明治 | 55  | 20    |
      And 我尚未登入但已授權地理位置
      And 購物車為空

    # --------------------------------------------------
    # Scenario 1: 成功加入多個項目
    # --------------------------------------------------
    Scenario: 成功將多個項目加入空購物車
      When 顧客將 "經典蛋餅" (數量: 1) 加入購物車
      And 顧客將 "冰美式咖啡" (數量: 1) 加入購物車
      Then 購物車中應有 2 個獨立項目
      And 購物車的總金額應為 80 元
      And 顧客應看到一個顯示 "商品已加入" 的快顯通知
      And 購物車圖示應顯示數字 "2"

    # --------------------------------------------------
    # Scenario 2: 邊界情況 - 庫存不足
    # --------------------------------------------------
    Scenario: 嘗試將數量超過庫存的項目加入購物車
      Given "經典蛋餅" 的剩餘庫存為 10 份
      When 顧客嘗試將 "經典蛋餅" (數量: 15) 加入購物車
      Then 系統應顯示錯誤訊息 "無法加入：庫存不足，剩餘 10 份"
      And 購物車的總金額應保持為 0 元
      And 購物車應維持為空

    # --------------------------------------------------
    # Scenario 3: 修改購物車中的數量
    # --------------------------------------------------
    Scenario: 修改購物車中已存在項目的數量
      Given 購物車中已有 "經典蛋餅" (數量: 1)
      When 顧客將 "經典蛋餅" 的數量增加到 3
      Then 購物車中應仍然只有 1 個項目類型
      And "經典蛋餅" 的數量應顯示為 3
      And 購物車的總金額應為 105 元 (35 * 3)

    # --------------------------------------------------
    # Scenario 4: 從購物車移除項目
    # --------------------------------------------------
    Scenario: 從購物車移除單一項目
      Given 購物車中已有以下項目：
        | name       | quantity | subtotal |
        | 經典蛋餅   | 1        | 35       |
        | 冰美式咖啡 | 1        | 45       |
      And 購物車總金額為 80 元
      When 顧客從購物車移除 "冰美式咖啡"
      Then 購物車中應只剩 1 個項目
      And 購物車的總金額應更新為 35 元
      And 顧客應看到確認訊息 "已從購物車移除"
```

**Feature 2: 訂單結帳與支付處理**

```gherkin
# ================================================
# Feature 2: 訂單結帳與支付處理
# ================================================

Feature: 訂單結帳與支付處理
  作為一個顧客
  我希望能夠在結帳時選擇多種支付方式
  並在支付成功後立即收到訂單確認通知
  以確保訂單已送達餐廳

  Rule: 確保結帳流程支援多樣化的安全支付選項
    Background:
      Given 購物車中包含以下餐點：
        | name       | quantity | subtotal |
        | 經典蛋餅   | 2        | 70       |
        | 冰美式咖啡 | 1        | 45       |
      And 購物車總金額為 125 元（含運費 10 元）
      And 顧客已輸入有效的配送地址 "台北市信義區信義路五段 1 號"
      And 顧客已選擇 "預計 08:30 送達" 的時間
      And 支付閘道器 (Payment Gateway) 處於可接受交易的狀態

    # --------------------------------------------------
    # Scenario Outline: 使用不同支付方式成功結帳
    # --------------------------------------------------
    Scenario Outline: 使用不同支付方式成功結帳
      When 顧客選擇 <Payment_Method> 支付
      And 顧客提交訂單
      Then 支付閘道器應確認交易成功
      And 訂單應以「待處理 (Pending)」狀態創建
      And 訂單應包含以下資訊：
        | field              | value                       |
        | 訂單編號           | 自動生成（格式: ORD-YYYYMMDD-XXX） |
        | 總金額             | 125 元                      |
        | 支付方式           | <Payment_Method>            |
        | 配送地址           | 台北市信義區信義路五段 1 號 |
        | 預計送達時間       | 08:30                       |
      And 顧客應收到一封訂單確認郵件，包含訂單詳情
      And 顧客應被導向至訂單追蹤頁面

      Examples:
        | Payment_Method         |
        | 信用卡 (Visa/Mastercard) |
        | Apple Pay              |
        | LINE Pay               |
        | 現金 (Cash on Delivery)|

    # --------------------------------------------------
    # Scenario: 邊界情況 - 支付失敗
    # --------------------------------------------------
    Scenario: 處理支付失敗的情況
      Given 支付閘道器處於返回錯誤的狀態
      When 顧客選擇信用卡支付並提交訂單
      Then 系統應顯示錯誤訊息 "支付失敗，請檢查您的卡片資訊或嘗試其他支付方式"
      And 訂單不應被創建
      And 購物車的內容應保持不變
      And 顧客應仍然停留在結帳頁面
      And 系統應記錄支付失敗事件（用於後續分析）

    # --------------------------------------------------
    # Scenario: 邊界情況 - 配送地址無效
    # --------------------------------------------------
    Scenario: 配送地址不在服務範圍內
      Given 顧客輸入配送地址 "新竹市光復路二段 101 號"
      And 該地址不在系統的配送範圍內
      When 顧客嘗試提交訂單
      Then 系統應顯示錯誤訊息 "抱歉，該地址不在配送範圍內"
      And 系統應顯示最近的可配送地址建議
      And 訂單不應被創建
      And 顧客應被要求修改配送地址

    # --------------------------------------------------
    # Scenario: 訂單創建後的庫存扣減
    # --------------------------------------------------
    Scenario: 成功創建訂單後扣減庫存
      Given "經典蛋餅" 的當前庫存為 50 份
      When 顧客成功創建包含 2 份 "經典蛋餅" 的訂單
      Then "經典蛋餅" 的庫存應扣減為 48 份
      And 系統應記錄庫存變動日誌
      And 如果庫存低於 10 份，系統應發送補貨警告給管理員
```

**Feature 3: 訂單追蹤與狀態管理**

```gherkin
# ================================================
# Feature 3: 訂單追蹤與狀態管理（客戶端）
# ================================================

Feature: 訂單追蹤與狀態管理
  作為一個顧客
  我希望能夠即時追蹤我的訂單狀態
  並在狀態變更時收到通知
  以便掌握餐點準備進度

  Rule: 顧客必須能即時查看訂單狀態
    Background:
      Given 顧客已成功創建訂單 #ORD-20251214-001
      And 該訂單包含 2 份經典蛋餅
      And 訂單當前狀態為「待處理 (Pending)」

    # --------------------------------------------------
    # Scenario: 查看訂單詳情
    # --------------------------------------------------
    Scenario: 顧客查看訂單詳細資訊
      When 顧客在訂單追蹤頁面輸入訂單編號 #ORD-20251214-001
      Then 系統應顯示訂單的完整資訊：
        | field          | value                  |
        | 訂單編號       | #ORD-20251214-001      |
        | 訂單狀態       | 待處理                 |
        | 訂單時間       | 2025-12-14 07:45       |
        | 預計送達時間   | 2025-12-14 08:30       |
        | 配送地址       | 台北市信義區信義路五段 1 號 |
        | 總金額         | 125 元                 |
      And 系統應顯示訂單中的所有餐點項目

    # --------------------------------------------------
    # Scenario: 接收訂單狀態變更通知
    # --------------------------------------------------
    Scenario: 訂單狀態從「待處理」變更為「處理中」
      Given 管理員已接受訂單
      When 訂單狀態從「待處理」變更為「處理中」
      Then 顧客應收到推播通知：「您的訂單 #ORD-20251214-001 已開始製作」
      And 訂單追蹤頁面應自動更新狀態為「處理中」
      And 系統應顯示預計完成時間：「預計 08:20 完成」

    # --------------------------------------------------
    # Scenario: 邊界情況 - 訂單延遲
    # --------------------------------------------------
    Scenario: 訂單超過預計送達時間仍未完成
      Given 訂單的預計送達時間為 08:30
      And 當前時間為 08:35
      And 訂單狀態仍為「處理中」
      Then 系統應自動發送延遲通知給顧客：「抱歉，您的訂單延遲了，預計 08:45 送達」
      And 系統應記錄延遲事件（用於性能分析）
```

**Feature 4: 管理員訂單管理**

```gherkin
# ================================================
# Feature 4: 管理員訂單管理
# ================================================

Feature: 餐廳訂單管理後台
  作為餐廳管理員
  我希望能夠在後台清晰地查看所有待處理的訂單
  並能更新訂單狀態
  以便及時通知廚房開始製作，並向顧客提供準確的配送時間

  Rule: 管理員必須能夠有效地追蹤和更新訂單流程
    Background:
      Given 我已登入為具有訂單管理權限的管理員
      And 系統中存在以下訂單：
        | order_id           | status    | total | items          | created_at       |
        | #ORD-20251214-001  | Pending   | 125   | 經典蛋餅 x2    | 2025-12-14 07:45 |
        | #ORD-20251214-002  | In Progress | 80  | 冰美式咖啡 x1  | 2025-12-14 07:50 |

    # --------------------------------------------------
    # Scenario: 管理員接受並開始處理訂單
    # --------------------------------------------------
    Scenario: 管理員接受待處理訂單
      When 管理員在訂單 #ORD-20251214-001 頁面點擊「開始處理 (Start Processing)」按鈕
      Then 訂單狀態應更新為「處理中 (In Progress)」
      And 系統應記錄一個預計完成時間 (Estimated Completion Time)：當前時間 + 15 分鐘
      And 顧客端應用程式應立即收到狀態變更通知
      And 管理員應看到確認訊息：「訂單 #ORD-20251214-001 已開始處理」

    # --------------------------------------------------
    # Scenario: 管理員標記訂單為待配送
    # --------------------------------------------------
    Scenario: 管理員標記訂單為待配送
      Given 訂單 #ORD-20251214-001 的狀態為「處理中 (In Progress)」
      When 管理員在後台將訂單狀態更新為「待配送 (Ready for Delivery)」
      Then 系統應觸發配送人員的取餐通知
      And 顧客應收到包含預計送達時間的通知：「您的訂單已準備好，預計 08:30 送達」
      And 訂單列表中該訂單應移至「待配送」區域

    # --------------------------------------------------
    # Scenario: 邊界情況 - 訂單取消
    # --------------------------------------------------
    Scenario: 管理員取消訂單（緊急情況）
      Given 訂單 #ORD-20251214-001 的狀態為「待處理 (Pending)」
      When 管理員選擇「取消訂單」並輸入理由：「餐點材料不足」
      Then 訂單狀態應更新為「已取消 (Cancelled)」
      And 顧客應收到取消通知及全額退款資訊
      And 系統應自動觸發退款流程
      And 庫存應恢復（扣減的數量返還）
```
